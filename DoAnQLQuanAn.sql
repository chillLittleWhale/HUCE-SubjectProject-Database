CREATE DATABASE QL_QuanAnKFC
GO
USE QL_QuanAnKFC
GO
------------------------------------------------------ TAO TABLE --------------------------------------------------------------------------
CREATE TABLE ChucVu(
	MACV VARCHAR(10) NOT NULL,
	TENCV NVARCHAR(50),
	HSLUONG FLOAT,
	CONSTRAINT KC1 PRIMARY KEY (MACV)
	)
GO

CREATE TABLE NhanSu(
	MANS VARCHAR(10) NOT NULL,
	TENNS NVARCHAR(50),
	MACV VARCHAR(10),
	DCHI NVARCHAR(100),
	SDT VARCHAR(12),
	CONSTRAINT KC2 PRIMARY KEY (MANS),
	CONSTRAINT KN2 FOREIGN KEY (MACV) REFERENCES ChucVu(MACV)
	)
GO

CREATE TABLE KhuVuc(
	MAKV VARCHAR(10) NOT NULL,
	TENKV NVARCHAR(50),
	HSGKV FLOAT ,
	CONSTRAINT KC3 PRIMARY KEY (MAKV)
)
GO
CREATE TABLE Loai(
	MALOAI VARCHAR(10) NOT NULL ,
	TENLOAI NVARCHAR(50),
	HSGLOAI FLOAT,
	CONSTRAINT KC4 PRIMARY KEY (MALOAI)
	)
GO
CREATE TABLE SanPham(
	MASP VARCHAR(10) NOT NULL,
	TENSP NVARCHAR(50),
	GIASP FLOAT,
	MALOAI VARCHAR(10),
	Ghichu nvarchar(150),
	CONSTRAINT KC5 PRIMARY KEY (MASP),
	CONSTRAINT KN5 FOREIGN KEY (MALOAI) REFERENCES Loai(MALOAI)
	)
GO

CREATE TABLE KhoNL(
	MANL VARCHAR(10) NOT NULL,
	TENNL NVARCHAR(50),
	SOLUONG FLOAT,
	DONVI NVARCHAR(50),
	CONSTRAINT KC9 PRIMARY KEY(MANL)
	)
GO
CREATE TABLE ChiTiet_CT(
	MASP VARCHAR(10) NOT NULL,
	MANL VARCHAR(10) NOT NULL,
	SOLUONG FLOAT,
	CONSTRAINT KC6 PRIMARY KEY (MASP, MANL),
	CONSTRAINT KN6A FOREIGN KEY (MASP) REFERENCES SanPham( MASP),
	CONSTRAINT KN6B FOREIGN KEY (MANL) REFERENCES KhoNL( MANL)
	)
GO

CREATE TABLE HoaDon(
	MAHD VARCHAR(10) NOT NULL,
	MANLAP VARCHAR(10),
	NGAYLAP DATE,
	TENKH NVARCHAR(50),
	MAKV VARCHAR(10),
	TONGTIEN FLOAT,
	CONSTRAINT KC7 PRIMARY KEY (MAHD),
	CONSTRAINT KN7A FOREIGN KEY (MAKV) REFERENCES KhuVuc( MAKV),
	CONSTRAINT KN7B FOREIGN KEY (MANLAP) REFERENCES NhanSu( MANS)
	)
GO
-- Them truong TONGTIEN
ALTER TABLE HoaDon
ADD TONGTIEN FLOAT
GO

CREATE TABLE ChiTiet_HD(
	MAHD VARCHAR(10) NOT NULL,
	MASP VARCHAR(10) NOT NULL,
	SOLUONG INT,
	CONSTRAINT KC8 PRIMARY KEY(MAHD, MASP),
	CONSTRAINT KN8A FOREIGN KEY (MASP) REFERENCES SanPham( MASP),
	CONSTRAINT KN8B FOREIGN KEY (MAHD) REFERENCES HoaDon( MAHD)
)
GO

CREATE TABLE PhieuNhap(
	MAPN VARCHAR(10) NOT NULL,
	MANLAP VARCHAR(10),
	NGAYLAP DATE,
	TIENNHAP FLOAT,
	CONSTRAINT KC10 PRIMARY KEY(MAPN),
	CONSTRAINT KN10 FOREIGN KEY (MANLAP) REFERENCES NhanSu( MANS)
	)
GO
CREATE TABLE ChiTiet_PN(
	MAPN VARCHAR(10) NOT NULL,
	MANL VARCHAR(10) NOT NULL,
	SOLUONG FLOAT,
	CONSTRAINT KC11 PRIMARY KEY(MAPN, MANL),
	CONSTRAINT KN11A FOREIGN KEY (MAPN) REFERENCES PhieuNhap( MAPN),
	CONSTRAINT KN11B FOREIGN KEY (MANL) REFERENCES KhoNL( MANL)
	)
GO
CREATE TABLE BangChamCong(
	MABCC VARCHAR(10) NOT NULL,
	TENBCC NVARCHAR(50),
	MANLAP VARCHAR(10),
	NGAYLAP DATE,
	CONSTRAINT KC12 PRIMARY KEY(MABCC),
	CONSTRAINT KN12 FOREIGN KEY (MANLAP) REFERENCES NhanSu( MANS)
)
GO

CREATE TABLE ChiTiet_BCC(
	MABCC VARCHAR(10) NOT NULL,
	MANS VARCHAR(10) NOT NULL,
	NGAY1 VARCHAR(5),
	NGAY2 VARCHAR(5),
	NGAY3 VARCHAR(5),
	NGAY4 VARCHAR(5),
	NGAY5 VARCHAR(5),
	NGAY6 VARCHAR(5),
	NGAY7 VARCHAR(5),
	NGAY8 VARCHAR(5),
	NGAY9 VARCHAR(5),
	NGAY10 VARCHAR(5),
	NGAY11 VARCHAR(5),
	NGAY12 VARCHAR(5),
	NGAY13 VARCHAR(5),
	NGAY14 VARCHAR(5),
	NGAY15 VARCHAR(5),
	NGAY16 VARCHAR(5),
	NGAY17 VARCHAR(5),
	NGAY18 VARCHAR(5),
	NGAY19 VARCHAR(5),
	NGAY20 VARCHAR(5),
	NGAY21 VARCHAR(5),
	NGAY22 VARCHAR(5),
	NGAY23 VARCHAR(5),
	NGAY24 VARCHAR(5),
	NGAY25 VARCHAR(5),
	NGAY26 VARCHAR(5),
	NGAY27 VARCHAR(5),
	NGAY28 VARCHAR(5),
	NGAY29 VARCHAR(5),
	NGAY30 VARCHAR(5),
	NGAY31 VARCHAR(5),
	TONGCONG INT,
	CONSTRAINT KC13 PRIMARY KEY(MABCC, MANS),
	CONSTRAINT KN13A FOREIGN KEY (MABCC) REFERENCES BangChamCong( MABCC),
	CONSTRAINT KN13B FOREIGN KEY (MANS) REFERENCES NhanSu( MANS)
)
GO
 ALTER TABLE ChiTiet_BCC
 ADD TONGCONG INT
 GO

CREATE TABLE BangLuong(
	MABL VARCHAR(10) NOT NULL,
	TENBL NVARCHAR(50),
	MANLAP VARCHAR(10),
	NGAYLAP DATE,
	CONSTRAINT KC14 PRIMARY KEY(MABL),
	CONSTRAINT KN14 FOREIGN KEY (MANLAP) REFERENCES NhanSu( MANS)
	)
GO
ALTER TABLE BangLuong
ADD CONSTRAINT KN14B FOREIGN KEY (MABL) REFERENCES BangChamCong(MABCC)
GO

CREATE TABLE ChiTiet_BL(
	MABL VARCHAR(10) NOT NULL,
	MANS VARCHAR (10) NOT NULL,
	TENNS NVARCHAR(50),
	CHUCVU NVARCHAR(50),
	LUONG FLOAT DEFAULT 0,
	CONSTRAINT KC15 PRIMARY KEY (MABL, MANS),
	CONSTRAINT KN15A FOREIGN KEY (MABL) REFERENCES BangLuong( MABL),
	CONSTRAINT KN15B FOREIGN KEY (MANS) REFERENCES NhanSu( MANS)
	)
GO
----------------------------------------------------------- TAO TRIGGER------------------------------------------------------------------------------

CREATE TRIGGER Trigger_ChiTiet_PN
ON ChiTiet_PN
FOR INSERT
AS
BEGIN
	UPDATE KhoNL SET KhoNL.SOLUONG = KhoNL.SOLUONG + Inserted.SOLUONG 
	FROM Inserted, KhoNL
	WHERE KhoNL.MANL = Inserted.MANL
END
GO
-------------------------------------------------------------------------


CREATE TRIGGER Trigger_ChiTiet_HD
ON ChiTiet_HD
FOR INSERT
AS
BEGIN 
	DECLARE @DEM INT= 1;
	DECLARE @SOLOAINL INT;
	SELECT @SOLOAINL= COUNT(*) FROM inserted INNER JOIN ChiTiet_CT ON inserted.MASP= ChiTiet_CT.MASP;
	DECLARE @SL_CTHD INT = (SELECT SOLUONG FROM inserted)
	WHILE @DEM <= @SOLOAINL
	BEGIN
		UPDATE KhoNL 
		SET KhoNL.SOLUONG = KhoNL.SOLUONG - (SELECT (SL_ChiTiet * @SL_CTHD) AS TONGSL
											FROM ( SELECT ROW_NUMBER() OVER (ORDER BY MANL )
											AS ROWNUMBER, ChiTiet_CT.MASP, MANL, ChiTiet_CT.SOLUONG AS SL_ChiTiet
												FROM ChiTiet_CT INNER JOIN inserted ON inserted.MASP= ChiTiet_CT.MASP ) AS CC
												WHERE ROWNUMBER= @DEM
												)
		WHERE KhoNL.MANL IN (SELECT MANL 
											FROM ( SELECT ROW_NUMBER() OVER (ORDER BY MANL )
											AS ROWNUMBER, ChiTiet_CT.MASP, MANL, ChiTiet_CT.SOLUONG AS SL_ChiTiet
												FROM ChiTiet_CT INNER JOIN inserted ON inserted.MASP= ChiTiet_CT.MASP ) AS CC
												WHERE ROWNUMBER= @DEM
												)
		SET @DEM= @DEM +1;
	END
END
GO


----------------------------------------------------------------------------------------

--DROP TRIGGER Trigger_Tao_ChiTiet_BCC
CREATE TRIGGER Trigger_Tao_ChiTiet_BCC ON BangChamCong
FOR INSERT
AS
BEGIN
	DECLARE @a INT = 1; 
	DECLARE @soNS INT ; 
	SELECT @soNS =  COUNT(*) FROM NhanSu;
	DECLARE @MABCC VARCHAR(10);
	SELECT @MABCC = ( SELECT MABCC FROM inserted);
	WHILE @a <= @soNS
	BEGIN
		IF (@a <10)
		BEGIN
			INSERT INTO ChiTiet_BCC
					(MABCC, MANS, NGAY1, NGAY2, NGAY3, NGAY4, NGAY5,NGAY6, NGAY7, NGAY8, NGAY9, NGAY10, NGAY11, NGAY12, NGAY13, NGAY14, NGAY15,
					NGAY16, NGAY17, NGAY18, NGAY19, NGAY20, NGAY21, NGAY22, NGAY23, NGAY24, NGAY25, NGAY26,NGAY27, NGAY28,NGAY29,NGAY30,NGAY31, TONGCONG)
			VALUES(@MABCC, CONCAT( 'NS00', @a ), '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', 0 );
			--FROM inserted
			SET @a = @a+1;
		END
		ELSE IF (@a >=10)
		BEGIN
			INSERT INTO ChiTiet_BCC
					(MABCC, MANS, NGAY1, NGAY2, NGAY3, NGAY4, NGAY5,NGAY6, NGAY7, NGAY8, NGAY9, NGAY10, NGAY11, NGAY12, NGAY13, NGAY14, NGAY15,
					NGAY16, NGAY17, NGAY18, NGAY19, NGAY20, NGAY21, NGAY22, NGAY23, NGAY24, NGAY25, NGAY26,NGAY27, NGAY28,NGAY29,NGAY30,NGAY31, TONGCONG)
			VALUES(@MABCC, CONCAT( 'NS0', @a ), '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', 0 );
			--FROM inserted
			SET @a = @a+1;
		END

	END
END
GO
-----------------------------------------------------------------------------
--DROP TRIGGER Trigger_Tao_ChiTiet_BL
CREATE TRIGGER Trigger_Tao_ChiTiet_BL ON BangLuong
FOR INSERT
AS
BEGIN
	DECLARE @a INT = 1; 
	DECLARE @soNS INT ; 
	SELECT @soNS =  COUNT(*) FROM NhanSu;
	DECLARE @MABL VARCHAR(10);
	SELECT @MABL = ( SELECT MABL FROM inserted);
	WHILE @a <= @soNS
	BEGIN
		IF (@a <10)
		BEGIN
			DECLARE @TEN NVARCHAR(50);
			SELECT @TEN = (SELECT TENNS	FROM NhanSu WHERE MANS = CONCAT( 'NS00', @a ) )
			DECLARE @CV NVARCHAR(50);
			SELECT @CV= (SELECT TENCV FROM NhanSu INNER JOIN ChucVu ON NhanSu.MACV = ChucVu.MACV AND MANS= CONCAT( 'NS00', @a ) )
			INSERT INTO ChiTiet_BL
					(MABL, MANS,TENNS, CHUCVU,  LUONG )
			VALUES(@MABL, CONCAT( 'NS00', @a ), @TEN, @CV, 0 );
			SET @a = @a+1;
		END
		ELSE IF (@a >=10)
		BEGIN
			DECLARE @TEN2 NVARCHAR(50);
			SELECT @TEN2 = (SELECT TENNS FROM NhanSu WHERE MANS = CONCAT( 'NS0', @a ) )
			DECLARE @CV2 NVARCHAR(50);
			SELECT @CV2= (SELECT TENCV FROM NhanSu INNER JOIN ChucVu ON NhanSu.MACV = ChucVu.MACV AND MANS= CONCAT( 'NS0', @a ) )
			INSERT INTO ChiTiet_BL
					(MABL, MANS,TENNS, CHUCVU,  LUONG )
			VALUES(@MABL, CONCAT( 'NS0', @a ),@TEN2, @CV2, 0 );
			SET @a = @a+1;
		END
	END
END
GO
-------------------------------------------------------------------------------------

--DROP TRIGGER Trigger_TangCong_TinhLuong
CREATE TRIGGER Trigger_TangCong_TinhLuong ON ChiTiet_BCC
FOR UPDATE
AS
BEGIN 
	DECLARE @HSL FLOAT;
	SELECT @HSL = (SELECT HSLUONG FROM ChucVu INNER JOIN (NhanSu INNER JOIN inserted ON NhanSu.MANS= inserted.MANS) 
					ON  ChucVu.MACV= (SELECT MACV FROM (NhanSu INNER JOIN inserted ON NhanSu.MANS= inserted.MANS) ) )
	DECLARE @MANS VARCHAR(10);
	SELECT @MANS= (SELECT MANS FROM inserted)
	DECLARE @MABCC VARCHAR(10);
	SELECT @MABCC= (SELECT MABCC FROM inserted)
	IF UPDATE (NGAY1)
	BEGIN
		DECLARE @GT VARCHAR(5);
		SELECT @GT= (SELECT NGAY1 FROM inserted );
		IF (@GT= 'D' OR @GT= 'M' OR @GT= 'CN' OR @GT= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY2)
	BEGIN
		DECLARE @GT2 VARCHAR(5);
		SELECT @GT2= (SELECT NGAY2 FROM inserted );
		IF (@GT2= 'D' OR @GT2= 'M' OR @GT2= 'CN' OR @GT2= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT2= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT2= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT2= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT2= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY3)
	BEGIN
		DECLARE @GT3 VARCHAR(5);
		SELECT @GT3= (SELECT NGAY3 FROM inserted );
		IF (@GT3= 'D' OR @GT3= 'M' OR @GT3= 'CN' OR @GT3= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT3= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT3= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT3= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT3= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY4)
	BEGIN
		DECLARE @GT4 VARCHAR(5);
		SELECT @GT4= (SELECT NGAY4 FROM inserted );
		IF (@GT4= 'D' OR @GT4= 'M' OR @GT4= 'CN' OR @GT4= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT4= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT4= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT4= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT4= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY5)
	BEGIN
		DECLARE @GT5 VARCHAR(5);
		SELECT @GT5= (SELECT NGAY5 FROM inserted );
		IF (@GT5= 'D' OR @GT5= 'M' OR @GT5= 'CN' OR @GT5= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT5= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT5= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT5= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT5= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY6)
	BEGIN
		DECLARE @GT6 VARCHAR(5);
		SELECT @GT6= (SELECT NGAY6 FROM inserted );
		IF (@GT6= 'D' OR @GT6= 'M' OR @GT6= 'CN' OR @GT6= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT6= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT6= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT6= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT6= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY7)
	BEGIN
		DECLARE @GT7 VARCHAR(5);
		SELECT @GT7= (SELECT NGAY7 FROM inserted );
		IF (@GT7= 'D' OR @GT7= 'M' OR @GT7= 'CN' OR @GT7= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT7= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT7= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT7= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT7= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY8)
	BEGIN
		DECLARE @GT8 VARCHAR(5);
		SELECT @GT8= (SELECT NGAY8 FROM inserted );
		IF (@GT8= 'D' OR @GT8= 'M' OR @GT8= 'CN' OR @GT8= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT8= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT8= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT8= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT8= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY9)
	BEGIN
		DECLARE @GT9 VARCHAR(5);
		SELECT @GT9= (SELECT NGAY9 FROM inserted );
		IF (@GT9= 'D' OR @GT9= 'M' OR @GT9= 'CN' OR @GT9= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT9= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT9= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT9= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT9= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY10)
	BEGIN
		DECLARE @GT10 VARCHAR(5);
		SELECT @GT10= (SELECT NGAY10 FROM inserted );
		IF (@GT10= 'D' OR @GT10= 'M' OR @GT10= 'CN' OR @GT10= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT10= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT10= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT10= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT10= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY11)
	BEGIN
		DECLARE @GT11 VARCHAR(5);
		SELECT @GT11= (SELECT NGAY11 FROM inserted );
		IF (@GT11= 'D' OR @GT11= 'M' OR @GT11= 'CN' OR @GT11= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT11= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT11= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT11= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT11= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY12)
	BEGIN
		DECLARE @GT12 VARCHAR(5);
		SELECT @GT12= (SELECT NGAY12 FROM inserted );
		IF (@GT12= 'D' OR @GT12= 'M' OR @GT12= 'CN' OR @GT12= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT12= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT12= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT12= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT12= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY13)
	BEGIN
		DECLARE @GT13 VARCHAR(5);
		SELECT @GT13= (SELECT NGAY13 FROM inserted );
		IF (@GT13= 'D' OR @GT13= 'M' OR @GT13= 'CN' OR @GT13= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT13= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT13= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT13= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT13= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY14)
	BEGIN
		DECLARE @GT14 VARCHAR(5);
		SELECT @GT14= (SELECT NGAY14 FROM inserted );
		IF (@GT14= 'D' OR @GT14= 'M' OR @GT14= 'CN' OR @GT14= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT14= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT14= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT14= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT14= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY15)
	BEGIN
		DECLARE @GT15 VARCHAR(5);
		SELECT @GT15= (SELECT NGAY15 FROM inserted );
		IF (@GT15= 'D' OR @GT15= 'M' OR @GT15= 'CN' OR @GT15= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT15= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT15= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT15= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT15= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY16)
	BEGIN
		DECLARE @GT16 VARCHAR(5);
		SELECT @GT16= (SELECT NGAY16 FROM inserted );
		IF (@GT16= 'D' OR @GT16= 'M' OR @GT16= 'CN' OR @GT16= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT16= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT16= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT16= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT16= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY17)
	BEGIN
		DECLARE @GT17 VARCHAR(5);
		SELECT @GT17= (SELECT NGAY17 FROM inserted );
		IF (@GT17= 'D' OR @GT17= 'M' OR @GT17= 'CN' OR @GT17= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT17= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT17= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT17= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT17= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY18)
	BEGIN
		DECLARE @GT18 VARCHAR(5);
		SELECT @GT18= (SELECT NGAY18 FROM inserted );
		IF (@GT18= 'D' OR @GT18= 'M' OR @GT18= 'CN' OR @GT18= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT18= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT18= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT18= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT18= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY19)
	BEGIN
		DECLARE @GT19 VARCHAR(5);
		SELECT @GT19= (SELECT NGAY19 FROM inserted );
		IF (@GT19= 'D' OR @GT19= 'M' OR @GT19= 'CN' OR @GT19= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT19= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT19= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT19= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT19= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY20)
	BEGIN
		DECLARE @GT20 VARCHAR(5);
		SELECT @GT20= (SELECT NGAY20 FROM inserted );
		IF (@GT20= 'D' OR @GT20= 'M' OR @GT20= 'CN' OR @GT20= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT20= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT20= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT20= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT20= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY21)
	BEGIN
		DECLARE @GT21 VARCHAR(5);
		SELECT @GT21= (SELECT NGAY21 FROM inserted );
		IF (@GT21= 'D' OR @GT21= 'M' OR @GT21= 'CN' OR @GT21= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT21= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT21= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT21= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT21= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY2)
	BEGIN
		DECLARE @GT22 VARCHAR(5);
		SELECT @GT22= (SELECT NGAY22 FROM inserted );
		IF (@GT22= 'D' OR @GT22= 'M' OR @GT22= 'CN' OR @GT22= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT22= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT22= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT22= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT22= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY23)
	BEGIN
		DECLARE @GT23 VARCHAR(5);
		SELECT @GT23= (SELECT NGAY23 FROM inserted );
		IF (@GT23= 'D' OR @GT23= 'M' OR @GT23= 'CN' OR @GT23= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT23= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT23= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT23= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT23= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY24)
	BEGIN
		DECLARE @GT24 VARCHAR(5);
		SELECT @GT24= (SELECT NGAY24 FROM inserted );
		IF (@GT24= 'D' OR @GT24= 'M' OR @GT24= 'CN' OR @GT24= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT24= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT24= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT24= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT24= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY25)
	BEGIN
		DECLARE @GT25 VARCHAR(5);
		SELECT @GT25= (SELECT NGAY25 FROM inserted );
		IF (@GT25= 'D' OR @GT25= 'M' OR @GT25= 'CN' OR @GT25= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT25= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT25= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT25= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT25= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY26)
	BEGIN
		DECLARE @GT26 VARCHAR(5);
		SELECT @GT26= (SELECT NGAY26 FROM inserted );
		IF (@GT26= 'D' OR @GT26= 'M' OR @GT26= 'CN' OR @GT26= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT26= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT26= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT26= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT26= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY27)
	BEGIN
		DECLARE @GT27 VARCHAR(5);
		SELECT @GT27= (SELECT NGAY27 FROM inserted );
		IF (@GT27= 'D' OR @GT27= 'M' OR @GT27= 'CN' OR @GT27= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT27= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT27= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT27= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT27= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY28)
	BEGIN
		DECLARE @GT28 VARCHAR(5);
		SELECT @GT28= (SELECT NGAY28 FROM inserted );
		IF (@GT28= 'D' OR @GT28= 'M' OR @GT28= 'CN' OR @GT28= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT28= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT28= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT28= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT28= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY29)
	BEGIN
		DECLARE @GT29 VARCHAR(5);
		SELECT @GT29= (SELECT NGAY29 FROM inserted );
		IF (@GT29= 'D' OR @GT29= 'M' OR @GT29= 'CN' OR @GT29= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT29= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT29= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT29= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT29= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END

	IF UPDATE (NGAY30)
	BEGIN
		DECLARE @GT30 VARCHAR(5);
		SELECT @GT30= (SELECT NGAY30 FROM inserted );
		IF (@GT30= 'D' OR @GT30= 'M' OR @GT30= 'CN' OR @GT30= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT30= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT30= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT30= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT30= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END
	IF UPDATE (NGAY31)
	BEGIN
		DECLARE @GT31 VARCHAR(5);
		SELECT @GT31= (SELECT NGAY31 FROM inserted );
		IF (@GT31= 'D' OR @GT31= 'M' OR @GT31= 'CN' OR @GT31= 'L')
		BEGIN 
			UPDATE ChiTiet_BCC SET TONGCONG= TONGCONG + 1
			WHERE MABCC= @MABCC AND MANS= @MANS
			IF @GT31= 'D'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT31= 'M'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 0.8 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT31= 'CN'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 1.5 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
			IF @GT31= 'L'
			BEGIN
				UPDATE ChiTiet_BL 
				SET LUONG= LUONG + (@HSL * 2 * 200000)
				WHERE @MANS = ChiTiet_BL.MANS AND ChiTiet_BL.MABL = @MABCC
			END
		END
	END
END
GO


-------------------------------------------------------	XOA TOAN BO-----------------------------------------------------------------------
--DROP TABLE ChiTiet_BL
--DROP TABLE BangLuong
--DROP TABLE ChiTiet_BCC
--DROP TABLE BangChamCong
--DROP TABLE ChiTiet_PN
--DROP TABLE PhieuNhap
--DROP TABLE ChiTiet_HD
--DROP TABLE HoaDon
--DROP TABLE ChiTiet_CT
--DROP TABLE KhoNL
--DROP TABLE SanPham
--DROP TABLE Loai
--DROP TABLE KhuVuc
--DROP TABLE NhanSu
--DROP TABLE ChucVu
 
 -- Them, sua phan ChucVu
 INSERT INTO ChucVu 
 VALUES ('cv001' , N'QuanLy', 2.0) 
 GO
 INSERT INTO ChucVu 
 VALUES ('cv002' , N'ThuKho', 2.0) 
 GO
 INSERT INTO ChucVu 
 VALUES ('cv003' , N'ThuNgan', 1.5) 
 GO
 INSERT INTO ChucVu 
 VALUES ('cv004' , N'NS Bep', 1.2) 
 GO
 INSERT INTO ChucVu 
 VALUES ('cv005' , N'PhucVu', 1.0) 
 GO

 UPDATE ChucVu
 SET HSLUONG = 1.6
 WHERE TENCV = N'ThuKho'

-- Them sua phan Loai
INSERT INTO Loai
VALUES ('L001', N'Đồ Ăn', 1)
GO
INSERT INTO Loai
VALUES ('L002', N'Thức Uống', 1)
GO
INSERT INTO Loai
VALUES ('L003', N'Combo', 1)
GO

UPDATE Loai
SET HSGLOAI = 0.9
WHERE TENLOAI = N'Combo'
GO

-- Them sua phan KhuVuc
INSERT INTO KhuVuc
VALUES ('KV001', N'Tầng 1 ', 1) 
GO
INSERT INTO KhuVuc
VALUES ('KV002', N'Tầng 2 ', 1.05) 
GO
INSERT INTO KhuVuc
VALUES ('KV003', N'Tầng 3 ', 1) 
GO
INSERT INTO KhuVuc
VALUES ('KV000', N'Mang về', 0.95) 
GO

UPDATE KhuVuc
SET TENKV= N'Tầng 1'
WHERE MAKV= 'KV001'
GO
UPDATE KhuVuc
SET HSGKV = 1.1
WHERE TENKV= N'Tầng 3'
GO
-- Them sua phan NhanSu
INSERT INTO NhanSu
VALUES ( 'NS001', N' Trần Văn Phát ', 'cv001', N' sn2, phường TD, quận HBT, HN', '0738475926' )
GO
INSERT INTO NhanSu
VALUES ( 'NS002', N' Nguyễn Phương Thảo ', 'cv003', N' sn23, phường DD, quận HBT, HN', '0738475944' )
GO
INSERT INTO NhanSu
VALUES ( 'NS003', N' Lê Minh Thịnh ', 'cv002', N' sn12, phường TD, quận HK, TH', '0938475556' )
GO
INSERT INTO NhanSu
VALUES ( 'NS012', N' Ngô Anh Tài ', 'cv004', N' sn25, phường TD, tp TH, TH', '0938475631' )
GO
INSERT INTO NhanSu
VALUES ( 'NS004', N' Triệu Hải Sơn ', 'cv004', N' sn11, phường TD, quận BT, HN', '0738475969' )
GO
INSERT INTO NhanSu
VALUES ( 'NS005', N' Nguyễn Văn Thắng ', 'cv004', N' sn9, phường TD, quận HT, HN', '0738747587' )
GO
INSERT INTO NhanSu
VALUES ( 'NS006', N' Vũ Việt Hùng ', 'cv005', N' sn82, phường TD, quận KT, HP', '0738475926' )
GO
INSERT INTO NhanSu
VALUES ( 'NS007', N' Triệu Tử Long ', 'cv005', N' sn16, phường TD, quận HB, HT', '0918475920' )
GO
INSERT INTO NhanSu
VALUES ( 'NS008', N' Nguyễn Thị Yến Nhi ', 'cv005', N' sn30, phường TD, quận CG, NA', '0827364189' )
GO
INSERT INTO NhanSu
VALUES ( 'NS009', N' Phạm Như Quỳnh', 'cv005', N' sn51, phường MN, quận 1, HCM', '0948475921' )
GO
INSERT INTO NhanSu
VALUES ( 'NS010', N' Vũ Ngọc Sáng ', 'cv005', N' sn221, phường TD, quận BT, LS', '0818475922' )
GO
INSERT INTO NhanSu
VALUES ( 'NS011', N' Hoàng Thị Tuyết Quỳnh ', 'cv004', N' sn99, phường ND, quận HBT, CM', '0818475926' )
GO

UPDATE NhanSu
SET TENNS= N' Phí Thị Trà Mi '
WHERE SDT = '0827364189' 
GO
-- Them sua phan SanPham
ALTER TABLE SanPham
ADD Ghichu nvarchar(150) 
GO

INSERT INTO SanPham
VALUES ('SP001', N' Kem  ', 10000, 'L002', null) 
GO
INSERT INTO SanPham
VALUES ('SP002', N' Coca cola', 15000, 'L002', N' 1 lon 350ml')
GO
INSERT INTO SanPham
VALUES ('SP003', N' Pepsi ', 16000, 'L002', N'1 lon 380ml')
GO
INSERT INTO SanPham
VALUES ('SP004', N' Borger tôm', 45000, 'L001', null)
GO
INSERT INTO SanPham
VALUES ('SP005', N' Borger zinger', 40000, 'L001', null)
GO
INSERT INTO SanPham
VALUES ('SP006', N'Đùi gà cay', 20000, 'L001', null)
GO
INSERT INTO SanPham
VALUES ('SP007', N' Cánh gà hot wings', 15000, 'L001', null)
GO
INSERT INTO SanPham
VALUES ('SP008', N' Cơm gà quay tiêu', 35000, 'L001', null)
GO
INSERT INTO SanPham
VALUES ('SP009', N' Cơm gà truyền thống', 30000, 'L001', null)
GO
INSERT INTO SanPham
VALUES ('SP010', N' Cơm gà xiên que', 25000, 'L003', null)
GO
INSERT INTO SanPham
VALUES ('SP011', N' Combo Ultimate Zinger', 90000, 'L003', N' 1 Borger zinger, 2 cánh gà hot wings, 2 coca cola')
GO
INSERT INTO SanPham
VALUES ('SP012', N' Combo gia đình', 150000, 'L003', N' 1 cg xiên que, 1 cg quay tiêu, 1 cg truyền thống, 3 đùi gà cay, 3 pepsi')
GO
INSERT INTO SanPham
VALUES ('SP013', N' Combo Cold Summer', 60000, 'L003', N' 1 Borger tôm, 1 pepsi, 1 kem')
GO

-- them sua phan KhoNL
INSERT INTO KhoNL
VALUES ('NL001', N' Đùi gà', 310, N'cái')
GO
INSERT INTO KhoNL
VALUES ('NL002', N'Cánh gà', 430, N'cái ')
GO
INSERT INTO KhoNL
VALUES ('NL003', N'Kem', 243, N'cái ')
GO
INSERT INTO KhoNL
VALUES ('NL004', N'Gạo', 460, N'kg ')
GO
INSERT INTO KhoNL
VALUES ('NL005', N'Coca cola', 2250, N'lon')
GO
INSERT INTO KhoNL
VALUES ('NL006', N'Pepsi', 1920, N'lon')
GO
INSERT INTO KhoNL
VALUES ('NL007', N'Bột mì', 400, N' KG')
GO
INSERT INTO KhoNL
VALUES ('NL008', N'Thịt ức gà', 270, N' KG')
GO
INSERT INTO KhoNL
VALUES ('NL009', N'Salad', 800, N' lá')
GO
INSERT INTO KhoNL
VALUES ('NL010', N'Cà chua', 150, N' KG')
GO
INSERT INTO KhoNL
VALUES ('NL011', N'Phô mai', 260, N' KG')
GO
INSERT INTO KhoNL
VALUES ('NL012', N'Tôm', 100, N' KG')
GO
INSERT INTO KhoNL
VALUES ('NL013', N'Bột ớt', 50, N' KG')
GO
INSERT INTO KhoNL
VALUES ('NL014', N'Đường', 200, N' KG')
GO
INSERT INTO KhoNL
VALUES ('NL015', N'Muối', 250, N' KG')
GO

UPDATE KhoNL
SET DONVI= N'kg'
WHERE MANL='NL007' OR MANL='NL008' OR MANL='NL014'  
GO
UPDATE KhoNL
SET SOLUONG= FLOOR( SOLUONG)
WHERE DONVI= N' lá' or DONVI= N'lon' or DONVI= N'cái ' or DONVI= N'cái'
GO
-- them sua phan ChiTiet_CT
--KEM
INSERT INTO ChiTiet_CT
VALUES ('SP001', 'NL003', 1)
GO
-- Coca cola
INSERT INTO ChiTiet_CT
VALUES ('SP002', 'NL005', 1)
GO
--PEPSI
INSERT INTO ChiTiet_CT
VALUES ('SP003', 'NL006', 1)
GO
-- Borger tôm
INSERT INTO ChiTiet_CT
VALUES ('SP004', 'NL007', 0.1)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP004', 'NL009', 2)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP004', 'NL011', 0.05)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP004', 'NL012', 0.05)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP004', 'NL013', 0.002)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP004', 'NL015', 0.001)
GO
-- Borger zinger
INSERT INTO ChiTiet_CT
VALUES ('SP005', 'NL007', 0.1)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP005', 'NL008', 0.1)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP005', 'NL009', 2 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP005', 'NL010', 0.05 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP005', 'NL011', 0.05)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP005', 'NL012',0.001 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP005', 'NL013', 0.002)
GO
--Đùi gà cay
INSERT INTO ChiTiet_CT
VALUES ('SP006', 'NL001',1 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP006', 'NL007', 0.01)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP006', 'NL013', 0.005)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP006', 'NL014', 0.001 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP006', 'NL015', 0.002 )
GO
-- Cánh gà hot wings
INSERT INTO ChiTiet_CT
VALUES ('SP007', 'NL002',1 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP007', 'NL007',0.02 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP007', 'NL013',0.005 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP007', 'NL014', 0.002)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP007', 'NL015', 0.001)
GO
-- Cơm gà quay tiêu
INSERT INTO ChiTiet_CT
VALUES ('SP008', 'NL004', 0.12)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP008', 'NL008', 0.3)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP008', 'NL009', 0.01)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP008', 'NL010', 0.01)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP008', 'NL015', 0.001)
GO
-- Cơm gà truyền thống
INSERT INTO ChiTiet_CT
VALUES ('SP009', 'NL001',1 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP009', 'NL004',0.15 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP009', 'NL010', 0.005)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP009', 'NL011', 0.005 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP009', 'NL013', 0.002 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP009', 'NL015',0.001 )
GO
-- Cơm gà xiên que
INSERT INTO ChiTiet_CT
VALUES ('SP010', 'NL008', 0.4 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP010', 'NL004',0.15 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP010', 'NL010', 0.005)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP010', 'NL011', 0.005 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP010', 'NL013', 0.002 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP010', 'NL015',0.002 )
GO
-- Combo Ultimate Zinger (  1 Borger zinger, 2 cánh gà hot wings, 2 coca cola )
INSERT INTO ChiTiet_CT
VALUES ('SP011', 'NL002', 2 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP011', 'NL007', 0.5)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP011', 'NL008', 0.1)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP011', 'NL009', 2 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP011', 'NL010', 0.05 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP011', 'NL011', 0.05)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP011', 'NL012',0.001 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP011', 'NL013', 0.012)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP011', 'NL005', 2)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP011', 'NL014', 0.005)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP011', 'NL015', 0.002)
GO
-- Combo gia đình ( 1 cg xiên que, 1 cg quay tiêu, 1 cg truyền thống, 3 đùi gà cay, 3 pepsi)
INSERT INTO ChiTiet_CT
VALUES ('SP012', 'NL001',4 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP012', 'NL008', 0.7 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP012', 'NL004',0.45 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP012', 'NL006',3)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP012', 'NL007',0.03 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP012', 'NL009',0.01 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP012', 'NL010', 0.025)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP012', 'NL011', 0.01 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP012', 'NL013', 0.03 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP012', 'NL014',0.003 )
GO
INSERT INTO ChiTiet_CT
VALUES ('SP012', 'NL015',0.007 )
GO
-- Combo Cold Summer ( 1 Borger tôm, 1 pepsi, 1 kem )
INSERT INTO ChiTiet_CT
VALUES ('SP013', 'NL003', 1)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP013', 'NL006', 1)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP013', 'NL007', 0.1)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP013', 'NL009', 2)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP013', 'NL011', 0.05)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP013', 'NL012', 0.05)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP013', 'NL013', 0.002)
GO
INSERT INTO ChiTiet_CT
VALUES ('SP013', 'NL015', 0.001)
GO

-- TAO HOA DON
INSERT INTO HoaDon
VALUES ('HD001', 'NS001', '2022-01-01', N' Nguyễn Văn Trung ', 'KV001', 25000) 
GO

INSERT INTO HoaDon
VALUES ('HD002', 'NS001', '2022-01-02', N' Trần Văn Thọ ', 'KV000', 28000) 
GO

INSERT INTO HoaDon
VALUES ('HD003', 'NS001', '2022-03-04', N' Trần Anh Tú ', 'KV002', 46000) 
GO
INSERT INTO HoaDon
VALUES ('HD004', 'NS001', '2022-03-04', N' Trần Anh Tú ', 'KV002', 50000) 
GO
-- tao ChiTiet_HD
INSERT INTO ChiTiet_HD
VALUES('HD001', 'SP001', 1)
GO
INSERT INTO ChiTiet_HD
VALUES('HD001', 'SP002', 1)
GO

INSERT INTO ChiTiet_HD
VALUES('HD002', 'SP001', 2)
GO
INSERT INTO ChiTiet_HD
VALUES('HD002', 'SP003', 3)
GO

INSERT INTO ChiTiet_HD
VALUES('HD003', 'SP003', 2)
GO
INSERT INTO ChiTiet_HD
VALUES('HD003', 'SP009', 1)
GO

DELETE FROM ChiTiet_HD
WHERE MASP = 'SP009'
GO
-------------------
DELETE FROM ChiTiet_HD
WHERE MAHD='HD001'
GO
-- TAO PhieuNhap
INSERT INTO PhieuNhap
VALUES ( 'PN002', 'NS002', '2022-03-10', 3570000)
GO

-- TAO ChiTiet_PN
INSERT INTO ChiTiet_PN
VALUES( 'PN001', 'NL003', 1)
GO
INSERT INTO ChiTiet_PN
VALUES( 'PN001', 'NL006', 1)
GO


--Tao BangChamCong

INSERT INTO BangChamCong
VALUES( 'B001', N'Bảng chấm công tháng 1/2022',  'NS002', '2022-01-01')
GO

INSERT INTO BangChamCong
VALUES( 'B002', N'Bảng chấm công tháng 2/2022',  'NS002', '2022-02-01')
GO

DELETE FROM ChiTiet_BCC
WHERE MABCC='B001'
GO

-- Tao BangLuong
INSERT INTO BangLuong
VALUES( 'B001', N'Bảng lương tháng 1/2022',  'NS001', '2022-01-01')
GO

INSERT INTO BangLuong
VALUES( 'B002', N'Bảng lương tháng 2/2022',  'NS002', '2022-02-01')
GO

DELETE FROM BangLuong
WHERE MABL='B002'
GO

DELETE FROM ChiTiet_BL
WHERE MABL='B002'
GO

-- ChiTiet_BCC
ALTER TABLE ChiTiet_BCC
ADD TONGCONG INT
GO
-- CHAM CONG NHAN SU
UPDATE ChiTiet_BCC
SET NGAY2 = 'P', NGAY4='M'
WHERE MANS = 'NS001' AND MABCC = 'B002'
GO

UPDATE ChiTiet_BCC
SET NGAY2 = 'P', NGAY4='M', NGAY1='P', NGAY3='CN'
WHERE MANS = 'NS002' AND MABCC = 'B002'
GO
------------------------------------------------------ TAO CAU LENH TRUY VAN-----------------------------------------------------------

-- Đưa ra danh sách top 3 sản phẩm bán chạy nhất năm 2022
SELECT TOP(3) *
FROM (  SELECT  MASP as [Mã SP], SUM(SOLUONG) AS [Tổng số lượng]
        FROM ChiTiet_HD INNER JOIN  HoaDon on ChiTiet_HD.MAHD= HoaDon.MAHD
		WHERE YEAR(NGAYLAP) = '2022'
		GROUP BY MASP ) AS CC
ORDER BY [Tổng số lượng] DESC
GO

-- Đưa ra sản phẩm có doanh số thấp top 3 trong tháng 1/2022
SELECT * FROM(
SELECT ROW_NUMBER() OVER (ORDER BY TONGSL ASC ) AS ROWNUMBER, MASP,  TONGSL
FROM (SELECT MASP , SUM(SOLUONG) AS TONGSL
        FROM ChiTiet_HD INNER JOIN  HoaDon on ChiTiet_HD.MAHD= HoaDon.MAHD
		WHERE YEAR(NGAYLAP) = '2022' AND MONTH(NGAYLAP)= '1'
		GROUP BY MASP) AS CC )  AS CCC 
WHERE  ROWNUMBER= 3
go
-- THƯỞNG 10% LƯƠNG CHO 3 NHÂN VIÊN CHUYÊN CẦN NHẤT TRONG THÁNG 1/2022
UPDATE ChiTiet_BL SET LUONG = LUONG * 1.1 
WHERE MANS IN (
	SELECT TOP(3) MANS
	FROM (  SELECT BangChamCong.MABCC, MANS, TONGCONG 
			FROM ChiTiet_BCC INNER JOIN BangChamCong ON ChiTiet_BCC.MABCC= BangChamCong.MABCC
			WHERE MONTH(NGAYLAP)= '1' AND YEAR(NGAYLAP)= '2022' ) AS CC
	ORDER BY TONGCONG DESC )
AND MABL = ( SELECT DISTINCT BangChamCong.MABCC AS MABL
			 FROM ChiTiet_BCC INNER JOIN BangChamCong ON ChiTiet_BCC.MABCC= BangChamCong.MABCC
			WHERE MONTH(NGAYLAP)= '1' AND YEAR(NGAYLAP)= '2022') 
go
-- Đưa ra thống kê số hoá đơn từng khu vực và doanh thu tương ứng trong năm 2022
SELECT KHUVUC.MAKV AS [ Mã Khu Vực], TENKV as [Khu Vực], COUNT(MAHD) AS [ Số Đơn ], SUM(TONGTIEN) AS [ Tổng Thu]
FROM HoaDon FULL OUTER JOIN KhuVuc ON KhuVuc.MAKV= HoaDon.MAKV 
WHERE  YEAR(NGAYLAP)= '2022'	 
GROUP BY TENKV, KhuVuc.MAKV
GO
-- ĐƯA RA DANH SÁCH TOP 10% NHÂN VIÊN CÓ LƯƠNG CAO NHẤT TRONG THÁNG 1/2022
SELECT DISTINCT TOP (10) PERCENT
NhanSu.MANS as [Mã nhân sự ], NhanSu.TENNS as [ Tên nhân sự ], ChiTiet_BL.CHUCVU as [ Chức Vụ ], ChiTiet_BL.LUONG as [ Lương], NhanSu.DCHI as [ Địa Chỉ], NhanSu.SDT as [ SĐT]
FROM ChiTiet_BL INNER JOIN NhanSu ON NhanSu.MANS= ChiTiet_BL.MANS 
	 INNER JOIN BangLuong  ON  BangLuong.MABL= ChiTiet_BL.MABL
WHERE YEAR(NGAYLAP)= '2022' AND MONTH(NGAYLAP)='1'
ORDER BY LUONG DESC
GO
-- TĂNG GIÁ BÁN CÁC SP BÁN CHẠY TOP 1 LÊN 20%
UPDATE SanPham SET GIASP = GIASP* 1.2 WHERE TENSP IN(
SELECT SanPham.TENSP
FROM HoaDon INNER JOIN 
	 ChiTiet_HD ON HoaDon.MAHD= ChiTiet_HD.MAHD INNER JOIN 
	 SanPham ON SanPham.MASP = ChiTiet_HD.MASP
GROUP BY SanPham.TENSP, SanPham.GIASP
HAVING (SUM ( ChiTiet_HD.SOLUONG ) =
	   (SELECT TOP(1) SUM ( ChiTiet_HD.SOLUONG) AS SOLUONG
	   FROM SanPham INNER JOIN 
	   ChiTiet_HD ON SanPham.MASP= ChiTiet_HD.MASP INNER JOIN
	   HoaDon ON ChiTiet_HD.MAHD= HoaDon.MAHD
GROUP BY SanPham.TENSP, SanPham.GIASP
ORDER BY SUM( ChiTiet_HD.SOLUONG) DESC
) ) )
GO
-------------------------------------------- Làm bản word ------------------------------------------------------------------------
--Thêm nhân sự mới vào bảng NhanSu
INSERT INTO NhanSu
VALUES ( 'NS013', N' Trương Văn Ba ', 'cv004', N' sn15, phường nD, tp TB, TB', '0927842186' )
GO
-- Thêm sp Khoai tây chiên vào SanPham
INSERT INTO SanPham
VALUES ('SP014', N' Khoai tây chiên', 8000, 'L001', null)
GO
-- Thêm NL Khoai tây vào khoNL
INSERT INTO KhoNL
VALUES ('NL016', N'Khoai tây', 200, N' kg')
GO
-- them ChiTiet_CT của sp Khoai tây chiên
INSERT INTO ChiTiet_CT
VALUES ('SP014', 'NL014', 0.001), ('SP014', 'NL015', 0.001),('SP014', 'NL016', 0.4)
GO
-- Tạo 1 hoá đơn
INSERT INTO HoaDon
VALUES ('HD005', 'NS002', '2022-03-05', N' Nguyễn Đức Anh ', 'KV003', 67000) 
GO
-- thêm chi tiết Hoá đơn
INSERT INTO ChiTiet_HD
VALUES('HD005', 'SP002', 1)
GO
INSERT INTO ChiTiet_HD
VALUES ('HD005', 'SP008', 1)
GO
INSERT INTO ChiTiet_HD
VALUES ('HD005', 'SP014', 1)
GO
-- tạo 1 phiếu nhập
INSERT INTO PhieuNhap
VALUES ( 'PN002', 'NS002', '2022-03-10', 3570000)
GO
-- thêm chi tiết phiếu nhập
INSERT INTO ChiTiet_PN
VALUES( 'PN002', 'NL003', 500)
GO
INSERT INTO ChiTiet_PN
VALUES( 'PN002', 'NL016', 100)
GO
-- tạo bảng chấm công tháng 3
INSERT INTO BangChamCong
VALUES( 'B003', N'Bảng chấm công tháng 3/2022',  'NS002', '2022-03-01')
GO
-- tạo bảng lương tháng 3
INSERT INTO BangLuong
VALUES( 'B003', N'Bảng lương tháng 3/2022',  'NS002', '2022-03-01')
GO
-- Chấm công nhân viên tháng 3/2022
UPDATE ChiTiet_BCC
SET NGAY1 = 'P'
WHERE MANS = 'NS001' AND MABCC = 'B003'
GO
UPDATE ChiTiet_BCC
SET NGAY1 = 'P', NGAY2='CN',NGAY3='M'
WHERE MANS = 'NS002' AND MABCC = 'B003'
GO



